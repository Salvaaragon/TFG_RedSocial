{% extends 'base.html.twig' %}

{% block body %}
<div class="div_tournaments">
    <div class="jumbotron">
        <div class="container">
            <h1 class="display-4"><a style="text-decoration:none" href="{{ path('tournaments',{'platform':'todos'})}}">Juegos:</a> <a style="text-decoration:none" href="{{ path('game',{'game_name':game.name, 'page': 1})}}">{{game.name_normalized}}</a></h1>
            <h2><i class="fab fa-{{ game.platform|lower}}"></i> {{game.platform}}</h2>
            <h3>{{ tournament.name }}</h3>
            <h4>Fecha y hora: {{ tournament.datetime }}</h4>
            <h4>{{ tournament.type|capitalize }}</h4>
            {% if tournament.type == 'eliminatoria' %}
            <h5>Participantes requeridos: {{ tournament.participants_min }}</h5>
            {% else %}
            <h5>Participantes permitidos: {{ tournament.participants_min }} - {{ tournament.participants_max }}</h5>
            {% endif %}
            {% if tournament.limit_checkin_object|date('Y-m-d H:i') <= "now"|date('Y-m-d H:i') %}
                <h5>Inscripciones cerradas</h5>
            {% else %}
                <h5>Inscripción abierta hasta: {{ tournament.limit_checkin }}</h5>
            {% endif %}
            {% if tournament.is_active == false %}
            <h5>Torneo finalizado</h5>
            {% endif %}

            {% if is_granted('ROLE_MOD') %}
                {% if tournament.limit_checkin_object|date('Y-m-d H:i') <= "now"|date('Y-m-d H:i') 
                and (tournament.datetime_object|date('Y-m-d') > "now"|date('Y-m-d')) %}
                    {% if tournament.num_participants > tournament.participants_min or
                        tournament.num_participants == tournament.participants_min %}
                    <p class="lead">    
                        Accede a los emparejamientos para gestionarlos
                    </p>
                    {% else %}
                    No se han inscrito los jugadores necesarios para realizar el torneo
                    {% endif %}
                {% endif %}
            {% endif %}

            {% if tournament.winner is defined and tournament.winner is not null %}
            <h3>Ganador: {{ tournament.winner }}</h3>
            {% endif %}
        </div>
    </div>
    <div class="row">
        <div class="col-lg-5 offset-lg-1">
            <div class="card">
                <div class="card-header">
                    <h5>Reglas del torneo</h5>
                </div>
                <div class="card-body">
                    <ol>
                    {% for rule in rules %}
                        <h4><li>{{rule.rule}}</li></h4>
                    {% endfor %}
                    </ol>
                </div>
            </div>
        </div>
        <div class="col-lg-4 offset-lg-1">
            <div class="card">
                <div class="card-header">
                    <h5>Acciones</h5>
                </div>
                <div class="card-body">
                    {% if is_granted('ROLE_USER') %}
                        <button type="button" class="btn btn-primary">Inscribirse</button>
                    {% endif %}
                    {% if tournament.type == "liga" %}
                        <button type="button" class="btn btn-success">Ver clasificación</button>
                    {% else %}
                        <a type="button" href="{{ path('tournament_pairing', {'game_name': tournament.game, 'id_tournament': tournament.id }) }}" class="btn btn-danger">Ver emparejamientos</a>
                    {% endif %}
                </div>
            </div>
            <br>
            <div class="card">
                <div class="card-header">
                    <h5>Lista de participantes</h5>
                </div>
                <div class="card-body">
                    {% if participants is defined and participants is not null %}
                        {% for participant in participants %}
                            {{ participant.username }}<br>
                        {% endfor %}
                    {% else %}
                        Este torneo aún no posee participantes
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block javascripts %}
    <script type="text/javascript"> 

    </script>
{% endblock %}